<!DOCTYPE html>
<html class="checkout-success">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content=" Thanh toán đơn hàng thành công!" />
    <title> Thanh toán đơn hàng thành công!</title>
    <link rel="shortcut icon" href="https://res.cloudinary.com/cockbook/image/upload/v1671249181/single/photo_2022-12-13_02-00-39_ylswk8-removebg-preview_pc6nqv.png" type="image/x-icon" />
    <link rel="stylesheet" href="/catalog/view/theme/default/stylesheet/checkout/checkout.min.css">
    <link rel="stylesheet" href="/catalog/view/theme/default/stylesheet/checkout/font-awesome.min.css">
    <script src="/catalog/view/theme/default/javascript/checkout/checkout.vendor.min.js"></script>
    <script src="/catalog/view/theme/default/javascript/checkout/checkout.min.js"></script>
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js" integrity="sha512-CryKbMe7sjSCDPl18jtJI5DR5jtkUWxPXWaLCst6QjH8wxDexfRJic2WRmRXmstr2Y8SxDDWuBO6CQC6IE4KTA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.js" integrity="sha512-NXopZjApK1IRgeFWl6aECo0idl7A+EEejb8ur0O3nAVt15njX9Gvvk+ArwgHfbdvJTCCGC5wXmsOUXX+ZZzDQw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js" integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</head>

<body>
    <header class="banner">
        <div class="wrap">
            <div class="logo logo--center">
                <h1 class="shop__name">
                    <a href="javascript:void(0)" onclick="document.location='http://127.0.0.1:5500/'" class="logo">
                        <h1 class="logo-text"><img src="https://res.cloudinary.com/cockbook/image/upload/v1671249181/single/photo_2022-12-13_02-00-39_ylswk8-removebg-preview_pc6nqv.png" alt="La Vie Est Belle Flower Boutique"></h1>
                    </a>
                </h1>
            </div>
        </div>
    </header>
    <div class="content">
        <div class="wrap wrap--mobile-fluid flexbox main-content">
            <main class="main main--nosidebar">
                <header class="main__header">
                    <div class="logo logo--center">
                        <h1 class="shop__name">
                            <a href="javascript:void(0)" onclick="document.location='http://127.0.0.1:5500/'" class="logo">
                                <h1 class="logo-text"><img src="https://res.cloudinary.com/cockbook/image/upload/v1671249181/single/photo_2022-12-13_02-00-39_ylswk8-removebg-preview_pc6nqv.png" alt="La Vie Est Belle Flower Boutique"></h1>
                            </a>
                        </h1>
                    </div>
                </header>
                <div class="main__content">
                    <article class="row">
                        <div class="col col--primary">
                            <section class="section section--icon-heading">
                                <div class="section__icon unprintable">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="72px" height="72px">
                                        <g fill="none" stroke="#8EC343" stroke-width="2">
                                            <circle cx="36" cy="36" r="35"
                                                    style="stroke-dasharray:240px, 240px; stroke-dashoffset: 480px;"></circle>
                                            <path d="M17.417,37.778l9.93,9.909l25.444-25.393"
                                                  style="stroke-dasharray:50px, 50px; stroke-dashoffset: 0px;"></path>
                                        </g>
                                    </svg>
                                </div>
                                <div class="thankyou-message-container">
                                    <h2 class="section__title">Cảm ơn bạn đã đặt hàng!</h2>
                                </div>
                            </section>
                            <section class="section">
                                <div class="section__content section__content--bordered">

                                    <div class="row">

                                        <div class="col col--md-two">
                                            <h2>Thông tin mua hàng</h2>
                                            <p id="name-user-book"></p>
                                            <p id="email-user-book"></p>
                                            <p id="phone-user-book"></p>
                                        </div>

                                        <div class="col col--md-two">
                                            <h2>Địa chỉ nhận hàng</h2>
                                            <p id="address-user-book"></p>
                                            <p>Việt Nam</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col col--md-two">
                                            <h2>Phương thức thanh toán</h2>
                                            <p id="method_name">_</p>
                                        </div>
                                        <div class="col col--md-two">
                                            <h2>Phương thức vận chuyển</h2>
                                            <p>Phí vận chuyển · 50,000đ</p>

                                        </div>
                                    </div>

                                </div>
                            </section>
                        </div>
                        <div class="col col--secondary">
                            <aside class="order-summary order-summary--bordered order-summary--is-collapsed" id="order-summary">
                                <div class="order-summary__header">
                                    <div class="order-summary__title">
                                        Mã đơn hàng #209 <span class="unprintable"></span>
                                    </div>
                                    <div class="order-summary__action hide-on-desktop unprintable">
                                        <a data-toggle="#order-summary" data-toggle-class="order-summary--is-collapsed" class="expandable">Xem chi tiết</a>
                                    </div>
                                </div>
                                <div class="order-summary__sections">
                                    <div class="order-summary__section order-summary__section--product-list order-summary__section--is-scrollable order-summary--collapse-element">
                                        <table class="product-table">
                                            <tbody id="list-item">
                                                
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="order-summary__section">
                                        <table class="total-line-table">
                                            <tbody class="total-line-table__tbody">

                                                <tr class="total-line total-line--subtotal">
                                                    <th class="total-line__name">Tạm tính</th>
                                                    <td id="total-price" class="total-line__price">0đ</td>
                                                </tr>


                                                <tr class="total-line total-line--shipping-fee">
                                                    <th class="total-line__name">Phí vận chuyển</th>
                                                    <td class="total-line__price">50,000đ</td>
                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="order-summary__section">
                                        <table class="total-line-table">
                                            <tbody class="total-line-table__tbody">
                                                <tr class="total-line payment-due">
                                                    <th class="total-line__name">
                                                        <span class="payment-due__label-total">Tổng cộng</span>
                                                    </th>
                                                    <td class="total-line__price">
                                                        <span id="grand-total-price" class="payment-due__price">0đ</span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </aside>
                            <aside class="order-checking order-checking--bordered order-checking--is-collapsed" id="order-checking">
                                <div class="order-checking__header">
                                    <div class="order-checking__title">
                                        Trạng thái đơn hàng <span class="unprintable"></span>
                                    </div>
                                    <div class="order-checking__action hide-on-desktop unprintable">
                                        <a data-toggle="#order-checking" data-toggle-class="order-checking--is-collapsed" class="expandable">Xem chi tiết</a>
                                    </div>
                                </div>
                                <div class="order-checking__sections">
                                    <div class="order-checking__section order-checking__section--product-list order-checking__section--is-scrollable order-checking--collapse-element">
                                        <div class="incidents-list format-expanded">
                                            <div class="status-day font-regular  ">
                                                <div class="date border-color font-large">
                                                    <span id="time-order"></span> <time class="timeline__time pull-right"><span></span></time>
                                                </div>
                                                <p class="color-secondary">Chờ xử lý</p>
                                                <p class="color-secondary"></p>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </aside>
                        </div>
                        <div class="col col--primary btn--contine">
                            <section class="section unprintable">

                                <div class="field__input-btn-wrapper field__input-btn-wrapper--floating field__input-btn-wrapper--mobile">
                                    <div class="field__input-btn-wrapper field__input-btn-wrapper--floating-left">
                                        <p class="step-footer-info">
                                            <i class="fa fa-question-circle-o"></i>
                                            <span>Cần hỗ trợ? <a href="mailto:hoant1905@gmail.com">Liên hệ chúng tôi</a></span>
                                        </p>
                                    </div>
                                    <div class="field__input-btn-wrapper field__input-btn-wrapper--floating-right">
                                        <button onclick="document.location='http://127.0.0.1:5500/'" class="btn btn--large">Tiếp tục mua hàng</button>
                                      
                                    </div>
                                </div>
                            </section>
                        </div>

                    </article>
                </div>


            </main>
        </div>

        <div class="wrap--mobile-fluid wrap" style="margin: 0 auto;width: 100%;    flex-direction: column-reverse;">
            <div class="main--nosidebar">
                <div class="main-footer footer-powered-by">
                    <span id="copyright">&copy; Copyright 2020-2022 . </span> </div>
            </div>
        </div>

    </div>
</body>
<script>
    async function getPayment() {
        const res= await axios({
            url: "http://localhost:8000/get_payment",
            method: "get",
            params: {
                id_payment: new URLSearchParams(window.location.search).get("idPayment")
            }
        })
        const result= await res.data
        document.getElementById("name-user-book").innerHTML= result.user_book?.[0].username
        document.getElementById("email-user-book").innerHTML= result.user_book?.[0].email
        document.getElementById("phone-user-book").innerHTML= result.user_book?.[0]?.phone_number
        document.getElementById("address-user-book").innerHTML= result.user_book?.[0].address
        document.getElementById("method_name").innerHTML= result?.user_book?.[0]?.method_name
        document.getElementById("time-order").innerHTML= moment(result.user_book?.[0].time_created).format("DD/MM/YYYY HH:mm:ss")
        document.getElementById("total-price").innerHTML= numberWithCommas(_.sumBy(result.items, function(e) {
            if(parseInt(e.discount) > 0) {
            return parseInt(e.amount) * parseInt(e.price) * (1 - parseInt(e.discount) / 100)
            
          }
          else {
            return parseInt(e.amount) * parseInt(e.price)
          }
        }))+ "đ"
        document.getElementById("grand-total-price").innerHTML= numberWithCommas(parseInt(_.sumBy(result.items, function(e) {
            if(parseInt(e.discount) > 0) {
            return parseInt(e.amount) * parseInt(e.price) * (1 - parseInt(e.discount) / 100)
            
          }
          else {
            return parseInt(e.amount) * parseInt(e.price)
          }
        })) + 50000)+ "đ"
        document.getElementById("list-item").innerHTML= result.items?.map(item=> {
            if(parseInt(item.discount) > 0) {
                return `
        <tr class="product">
            <td class="product__image">
                <div class="product-thumbnail">
                    <div class="product-thumbnail__wrapper">
                        <img src="${item.image1}" alt="Milkshake" class="product-thumbnail__image">
                    </div>
                    <span class="product-thumbnail__quantity unprintable">${item.amount}</span>
                </div>
            </td>
            <th class="product__description">
                <span class="product__description__name">${item.product_name}                                                                                                         </span>
            </th>
            <td class="product__quantity printable-only">1</td>
            <td class="product__price">${numberWithCommas(parseInt(item.price) * (1 - parseInt(item.discount) / 100))}đ</td>
    </tr>`
            }
            else {
                return `
        <tr class="product">
            <td class="product__image">
                <div class="product-thumbnail">
                    <div class="product-thumbnail__wrapper">
                        <img src="${item.image1}" alt="Milkshake" class="product-thumbnail__image">
                    </div>
                    <span class="product-thumbnail__quantity unprintable">${item.amount}</span>
                </div>
            </td>
            <th class="product__description">
                <span class="product__description__name">${item.product_name}                                                                                                         </span>
            </th>
            <td class="product__quantity printable-only">1</td>
            <td class="product__price">${numberWithCommas(parseInt(item.price))}đ</td>
    </tr>`
            }
        })
    }
    getPayment()
</script>
<script>
    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
</script>
</html>